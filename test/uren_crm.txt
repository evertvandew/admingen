import uren_crm

fsm Opdracht

[*] --> Aanvraag
Aanvraag --> Offerte : send
Offerte --> Aanvraag : reject
Offerte --> Lopend : accept
Lopend --> [*] : finish
.

fsm Factuur
[*] --> Test
Test --> Opgehouden : not FactuurReady
Test --> Review : FactuurReady
Opgehouden --> Review : FactuurReady
Review --> Verstuurd : send
Verstuurd --> Mislukt : senderror
Mislukt --> Verstuurd : send
Verstuurd, TeLaat, VeelTeLaat --> Voldaan : payed
Verstuurd --> TeLaat : now - factuur.verstuurd > 30d
TeLaat --> VeelTeLaat : now - factuur.verstuurd > 30d
VeelTeLaat --> [*] : FactuurAfgeschreven
Voldaan --> [*]  : FactuurOpruimen

.

fsm Weekstaat

[*] --> Open
Open --> Open : add Urenstaat
Open --> Gesloten : close
Gesloten --> Goedgekeurd : approve
Gesloten --> Open : reject
Goedgekeurd --> Gefactureerd : send
Gefactureerd --> [*]

.

actions
Opdracht.Offerte.entry: sendOfferte(offerte)
.


table Persoon
naam: str
email: email
telefoon: telefoonnr
werkgevers: Klant
.

table Werker
naam: str
standaardtarief: money
inzet : Set(WerkerTarief)
uren: Set(Urenregel)
.

table WerkerTarief
werker: Werker
opdracht: Opdracht
tarief: money
.

table Klant
naam: str
contactpersoon: Persoon
projecten: Set(Opdracht)
.

table Opdracht
naam: str
omschrijving: str, optional
start: date, optional
end: date, optional
opdrachtgever: Klant
werkers: Set(WerkerTarief)
uren: Set(Urenregel)
facturen: Set(Factuur)
pdf: blob
.

table Urenregel
week: Weekstaat
opdracht: Opdracht
werker: Werker
ma: float, default=0.0
di: float, default=0.0
wo: float, default=0.0
do: float, default=0.0
vr: float, default=0.0
za: float, default=0.0
zo: float, default=0.0
.

table Weekstaat
uren: Set(Urenregel)
weeknr: int
jaar: int
periode_start: datetime
periode_eind: datetime
.

table Factuur
opdracht: Opdracht
periode_start: datetime
periode_eind: datetime
totaal_uren: float
totaal_geld: money
pdf: blob
.

rules Opdracht
Offerte: Constant(opdrachtgever.contactpersoon.email, pdf)
.

rules Factuur
Verstuurd, TeLaat, VeelTeLaat, Voldaan: Constant(*)
Verstuurd, TeLaat, VeelTeLaat: Constant(opdracht.opdrachtgever.email)
.

rules Weekstaat
Gesloten, Goedgekeurd, Gefactureerd : Constant(*)
.
